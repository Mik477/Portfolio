import{q as b,w as g,r as S}from"./DQxZm1d5.js";const P=g("idle"),f=g({}),n=g({}),p=new Map,$=1e3,A=g(!1);b(n,t=>{const s=Object.values(t);if(s.length===0)return 0;let e=0,o=0;return s.forEach(d=>{const a=d.priority||1;e+=a;let i=0;switch(d.status){case"loaded":i=1;break;case"error":i=1;break;case"loading":i=d.progress||.5;break;default:i=0;break}o+=i*a}),e>0?o/e:0});const l={subscribe:n.subscribe,registerTask:(t,s="pending",e=1)=>{n.update(o=>(!o[t]||o[t].status==="idle"||o[t].status==="error"?o[t]={id:t,status:s,priority:e,progress:s==="loading"?.5:void 0}:o[t].priority=e,o))},updateTaskStatus:(t,s,e)=>{n.update(o=>(o[t]?(o[t].status!=="loaded"||s!=="loading")&&(o[t].status=s,e&&(o[t].message=e),(s==="loaded"||s==="error")&&(o[t].progress=1)):o[t]={id:t,status:s,message:e,progress:s==="loaded"?1:0},o))},updateTaskProgress:(t,s)=>{n.update(e=>(e[t]&&(e[t].progress=Math.max(0,Math.min(1,s))),e))},getTaskStatus:t=>{var e;return(e=S(n)[t])==null?void 0:e.status},resetTasks:()=>{n.set({}),A.set(!1),f.set({})},getAssetStatus:t=>S(f)[t]||"idle",setAssetStatus:(t,s)=>{f.update(e=>(e[t]=s,e))}},E=b(n,t=>{const s=Object.values(t);return s.length===0?"idle":s.some(e=>e.status==="error")?"error":s.every(e=>e.status==="loaded")?"loaded":s.some(e=>e.status==="loading"||e.status==="pending")?"loading":"idle"}),L=(t,s=1)=>{l.registerTask(t,"loading",s)};async function j(t){const s=[];for(const e of t){const o=l.getAssetStatus(e);if(o==="loaded")continue;if(o==="loading"){const a=p.get(e);a&&s.push(a);continue}l.setAssetStatus(e,"loading");const d=new Promise((a,i)=>{if(/\.(jpg|jpeg|png|webp|gif|svg)$/i.test(e)){const r=new Image;r.decoding="async";let u=!1;const m=()=>{r.onload=null,r.onerror=null},c=()=>{u||(u=!0,m(),l.setAssetStatus(e,"loaded"),a())},h=w=>{u||(u=!0,m(),l.setAssetStatus(e,"error"),i(w instanceof Error?w:new Error(`Failed to load image: ${e}`)))};r.onload=()=>{typeof r.decode=="function"?r.decode().then(c).catch(()=>{r.complete&&r.naturalWidth>0?c():h()}):c()},r.onerror=()=>h(new Error(`Failed to load image: ${e}`)),r.src=e}else/\.json$/i.test(e)?fetch(e).then(r=>{if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);return r.json()}).then(()=>{l.setAssetStatus(e,"loaded"),a()}).catch(r=>{l.setAssetStatus(e,"error"),i(new Error(`Failed to load font data: ${e} - ${r.message}`))}):(console.warn(`Preloading not implemented for file type: ${e}`),a())}).finally(()=>{p.delete(e)});p.set(e,d),s.push(d)}await Promise.all(s)}export{l as a,A as i,P as l,$ as m,E as o,j as p,L as s};
